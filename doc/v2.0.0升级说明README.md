# 学生综合测评系统 v2.0.0 升级说明

## 📋 版本信息

- **版本号**：v2.0.0
- **发布日期**：2025-11-09
- **升级类型**：重大功能升级
- **基础框架**：RuoYi-Vue 3.8.x

---

## 🎯 升级概述

本次升级实现了**学号登录系统**和**三级部门结构**，大幅提升了用户管理和学生档案管理的便捷性和数据一致性。

### 核心改进

1. ✅ **学号/工号登录**：学生使用学号登录，教职工使用工号登录
2. ✅ **三级部门结构**：学院 → 专业 → 班级，数据结构化管理
3. ✅ **批量导入增强**：自动创建学生档案，自动填充学院、专业、班级信息
4. ✅ **学生档案优化**：部门树选择器，自动填充功能
5. ✅ **旧功能废弃**：隐藏"考评加分记录"菜单（已被综测填报系统替代）

---

## 📦 升级内容

### 数据库变更

| 变更类型 | 对象 | 说明 |
|---------|------|------|
| 表结构修改 | `t_user_profile` | 新增`dept_id`字段（BIGINT） |
| 数据插入 | `sys_dept` | 新增10个班级部门、1个专业部门 |
| 数据更新 | `sys_menu` | 隐藏6个旧菜单项（考评加分记录） |
| 数据插入 | `sys_user` | 创建3个测试账号（2学生+1辅导员） |
| 数据插入 | `t_user_profile` | 创建2个测试学生档案 |

### 后端代码变更

| 文件 | 变更类型 | 说明 |
|------|---------|------|
| `TUserProfile.java` | 修改 | 添加`deptId`字段及getter/setter |
| `TUserProfileMapper.xml` | 修改 | 更新SQL查询，支持`dept_id`字段 |
| `SysUserServiceImpl.java` | 修改 | 增强批量导入，自动创建学生档案 |
| `SysUser.java` | 修改 | 优化@Excel注解，添加提示信息 |

### 前端代码变更

| 文件 | 变更类型 | 说明 |
|------|---------|------|
| `login.vue` | 修改 | 添加登录提示文字 |
| `t_user_profile/index.vue` | 修改 | 使用部门树选择器，自动填充功能 |

### 文档新增

| 文档 | 说明 |
|------|------|
| `批量导入用户指南.md` | 学生和教职工批量导入详细指南 |
| `Excel模板字段说明.md` | Excel模板字段详细说明 |
| `v2.0.0系统升级使用手册.md` | 系统升级后的完整使用手册 |
| `v2.0.0测试验证清单.md` | 测试验证清单 |
| `v2.0.0升级说明README.md` | 本文档 |

---

## 🚀 升级步骤

### 1. 数据库升级

**执行顺序**：

```bash
# 1. 执行主升级脚本
mysql -u root -p ry-vue < sql/upgrade/v2.0.0_student_login_and_dept_structure.sql

# 2. 执行热修复补丁
mysql -u root -p ry-vue < sql/upgrade/v2.0.0_hotfix_dept_conflict.sql
```

**验证**：

```sql
-- 检查部门创建
SELECT dept_id, dept_name, parent_id FROM sys_dept WHERE dept_id >= 500;

-- 检查字段添加
DESC t_user_profile;

-- 检查测试账号
SELECT user_id, user_name, nick_name FROM sys_user WHERE user_id >= 1000;
```

---

### 2. 后端代码部署

**步骤**：

```bash
# 1. 拉取最新代码
git pull origin main

# 2. 编译项目
mvn clean package

# 3. 重启后端服务
# （根据实际部署方式重启）
```

**验证**：

- 访问后端健康检查接口
- 查看日志确认无错误

---

### 3. 前端代码部署

**步骤**：

```bash
# 1. 进入前端目录
cd ruoyi-ui

# 2. 安装依赖（如有新增）
npm install

# 3. 构建生产版本
npm run build:prod

# 4. 部署到Web服务器
# （根据实际部署方式部署）
```

**验证**：

- 访问登录页面，检查提示文字
- 访问学生档案管理，检查部门树选择器

---

### 4. 功能测试

**测试清单**：

请参考《v2.0.0测试验证清单.md》进行完整测试，重点测试：

- ✅ 学号/工号登录
- ✅ 批量导入学生（自动创建档案）
- ✅ 学生档案管理（部门树选择器）
- ✅ 原有功能（综测填报、审核、统计）

---

## 📚 文档导航

### 用户文档

| 文档 | 适用对象 | 说明 |
|------|---------|------|
| [v2.0.0系统升级使用手册.md](./v2.0.0系统升级使用手册.md) | 所有用户 | 系统升级后的完整使用手册 |
| [批量导入用户指南.md](./批量导入用户指南.md) | 管理员、辅导员 | 批量导入学生和教职工的详细指南 |
| [Excel模板字段说明.md](./Excel模板字段说明.md) | 管理员、辅导员 | Excel模板字段详细说明 |

### 技术文档

| 文档 | 适用对象 | 说明 |
|------|---------|------|
| [v2.0.0升级说明README.md](./v2.0.0升级说明README.md) | 开发人员、运维人员 | 本文档，升级说明 |
| [v2.0.0测试验证清单.md](./v2.0.0测试验证清单.md) | 测试人员 | 测试验证清单 |

---

## 🔑 测试账号

系统已创建以下测试账号供测试使用：

### 学生账号

| 学号 | 密码 | 姓名 | 班级 |
|------|------|------|------|
| 2507240101 | 123456 | 张三 | 软工2401班 |
| 2507240102 | 123456 | 李四 | 软工2401班 |

### 教职工账号

| 工号 | 密码 | 姓名 | 部门 |
|------|------|------|------|
| T20240001 | 123456 | 王老师 | 软件工程专业 |

### 管理员账号

| 用户名 | 密码 | 说明 |
|--------|------|------|
| admin | admin123 | 系统管理员 |

---

## 📊 部门结构

### 三级部门树

```
西安文理学院（100）
├── 信息工程学院（101）
│   ├── 软件工程专业（103）
│   │   ├── 软工2401班（500）
│   │   ├── 软工2402班（501）
│   │   ├── 软工2301班（502）
│   │   └── 软工2302班（503）
│   └── 计算机科学与技术专业（104）
│       ├── 计科2401班（510）
│       ├── 计科2402班（511）
│       └── 计科2301班（512）
└── 机械与材料工程学院（102）
    └── 机械工程专业（210）
        ├── 机械2401班（530）
        └── 机械2402班（531）
```

### 部门ID规则

- **100-199**：学院级别
- **200-499**：专业级别
- **500-999**：班级级别

---

## ⚠️ 注意事项

### 升级前

1. ✅ **备份数据库**：务必备份生产环境数据库
2. ✅ **备份代码**：备份当前运行的代码版本
3. ✅ **通知用户**：提前通知用户系统升级时间
4. ✅ **测试环境验证**：先在测试环境完整测试

### 升级中

1. ✅ **按顺序执行**：严格按照升级步骤执行
2. ✅ **检查日志**：每步执行后检查日志
3. ✅ **验证结果**：每步执行后验证结果
4. ✅ **记录问题**：遇到问题及时记录

### 升级后

1. ✅ **功能测试**：完整测试所有功能
2. ✅ **性能监控**：监控系统性能
3. ✅ **用户培训**：培训用户使用新功能
4. ✅ **文档分发**：分发使用手册给用户

---

## 🐛 已知问题

目前无已知问题。

---

## 🔄 回滚方案

如果升级后出现严重问题，可按以下步骤回滚：

### 1. 数据库回滚

```sql
-- 删除新增的部门
DELETE FROM sys_dept WHERE dept_id >= 500;
DELETE FROM sys_dept WHERE dept_id = 210;

-- 删除测试账号
DELETE FROM sys_user WHERE user_id >= 1000;
DELETE FROM t_user_profile WHERE user_id >= 1000;

-- 删除dept_id字段
ALTER TABLE t_user_profile DROP COLUMN dept_id;

-- 恢复菜单显示
UPDATE sys_menu SET visible='0', status='0' WHERE menu_id BETWEEN 2043 AND 2048;
```

### 2. 代码回滚

```bash
# 回滚到升级前的版本
git checkout <previous_version_tag>

# 重新编译部署
mvn clean package
```

---

## 📞 技术支持

如遇到问题，请联系：

- **系统管理员**：[联系方式]
- **技术支持**：[联系方式]
- **开发团队**：[联系方式]

或查看系统日志：
- 路径：系统监控 → 日志管理 → 操作日志
- 关键字：用户管理、导入、学生档案

---

## 📝 更新日志

### v2.0.0 (2025-11-09)

**新增功能**：
- 学号/工号登录系统
- 三级部门结构（学院→专业→班级）
- 批量导入自动创建学生档案
- 学生档案管理部门树选择器
- 登录页面提示文字

**优化功能**：
- 批量导入功能增强
- 学生档案管理界面优化
- Excel模板提示信息优化

**废弃功能**：
- "考评加分记录"菜单（已被综测填报系统替代）

**数据库变更**：
- t_user_profile表新增dept_id字段
- 新增10个班级部门、1个专业部门
- 创建3个测试账号

**文档新增**：
- 批量导入用户指南
- Excel模板字段说明
- 系统升级使用手册
- 测试验证清单
- 升级说明README

---

## 🎉 致谢

感谢所有参与本次升级的开发人员、测试人员和用户！

---

**文档版本**：v2.0.0  
**更新日期**：2025-11-09  
**维护团队**：学生综合测评系统开发团队

