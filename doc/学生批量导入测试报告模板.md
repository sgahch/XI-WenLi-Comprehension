# 学生批量导入功能测试报告

## 测试信息

| 项目 | 内容 |
|------|------|
| 测试功能 | 学生批量导入 |
| 测试版本 | v1.0 |
| 测试人员 | [填写测试人员] |
| 测试日期 | [填写测试日期] |
| 测试环境 | [开发/测试/生产] |

## 测试环境配置

### 系统环境
- 操作系统: Windows/Linux/MacOS
- JDK版本: 1.8+
- 数据库: MySQL 8.0+
- 应用服务器: Spring Boot 内置Tomcat

### 数据库配置
- [ ] 部门结构已创建（信息学院 -> 专业 -> 班级）
- [ ] 角色配置完成（学生、班委、辅导员）
- [ ] 系统配置正确（初始密码等）

## 测试用例执行结果

### 测试用例1：下载导入模板

**测试目的**: 验证Excel模板下载功能

**测试步骤**:
1. 登录系统
2. 访问接口: `POST /evaluation/t_user_profile/importTemplate`
3. 下载Excel模板文件

**预期结果**:
- 成功下载Excel文件
- 文件包含10列表头
- 表头名称正确

**实际结果**: 
- [ ] 通过
- [ ] 失败

**备注**: 

---

### 测试用例2：正常导入（新增模式）

**测试目的**: 验证正常数据导入功能

**测试数据**: `学生批量导入测试数据_正常.xlsx`（10条记录）

**测试步骤**:
1. 准备测试Excel文件
2. 调用导入接口: `POST /evaluation/t_user_profile/importStudents?updateSupport=false`
3. 上传Excel文件

**预期结果**:
- 返回成功消息
- 提示"恭喜您，数据已全部导入成功！共 10 条"
- sys_user表新增10条记录
- t_user_profile表新增8条记录（2个辅导员不创建档案）
- sys_user_role表正确关联角色

**实际结果**: 
- [ ] 通过
- [ ] 失败

**验证SQL**:
```sql
-- 验证用户创建
SELECT COUNT(*) FROM sys_user WHERE user_name LIKE '2507%' OR user_name LIKE 'T2024%';
-- 预期: 10

-- 验证学生档案创建
SELECT COUNT(*) FROM t_user_profile WHERE student_id LIKE '2507%';
-- 预期: 8

-- 验证角色分配
SELECT u.user_name, GROUP_CONCAT(r.role_name) AS roles
FROM sys_user u
JOIN sys_user_role ur ON u.user_id = ur.user_id
JOIN sys_role r ON ur.role_id = r.role_id
WHERE u.user_name IN ('2507240101', '2507240102', 'T20240001')
GROUP BY u.user_name;
-- 预期: 
-- 2507240101: 学生
-- 2507240102: 学生,班委
-- T20240001: 辅导员
```

**备注**: 

---

### 测试用例3：数据验证测试

**测试目的**: 验证必填字段和数据合法性验证

**测试数据**: `学生批量导入测试数据_验证失败.xlsx`

**测试步骤**:
1. 准备包含错误数据的Excel文件
2. 调用导入接口
3. 检查错误提示

**预期结果**:
- 返回失败消息
- 提示"很抱歉，导入失败！共 X 条数据格式不正确"
- 详细列出每条错误信息：
  - 学号为空
  - 班级为空
  - 专业名称为空
  - 身份不合法
  - 姓名为空
  - 身份为空

**实际结果**: 
- [ ] 通过
- [ ] 失败

**错误信息示例**:
```
很抱歉，导入失败！共 6 条数据格式不正确，错误如下：
1、学号  导入失败：学号不能为空
2、学号 2507240999 导入失败：班级不能为空
3、学号 2507240998 导入失败：专业名称不能为空
4、学号 2507240997 导入失败：身份[教师]不合法，只能是：学生、班委、辅导员
5、学号 2507240996 导入失败：姓名不能为空
6、学号 2507240995 导入失败：身份不能为空
```

**备注**: 

---

### 测试用例4：部门不存在测试

**测试目的**: 验证部门匹配逻辑

**测试数据**: `学生批量导入测试数据_部门不存在.xlsx`

**测试步骤**:
1. 准备包含不存在部门的Excel文件
2. 调用导入接口
3. 检查错误提示

**预期结果**:
- 返回失败消息
- 提示"未找到专业[XXX]班级[XXX]对应的部门"

**实际结果**: 
- [ ] 通过
- [ ] 失败

**备注**: 

---

### 测试用例5：更新模式测试

**测试目的**: 验证更新已存在用户的功能

**前置条件**: 已执行测试用例2，数据库中存在测试数据

**测试步骤**:
1. 修改Excel中的部分数据（如手机号、邮箱）
2. 调用导入接口: `POST /evaluation/t_user_profile/importStudents?updateSupport=true`
3. 验证数据是否更新

**预期结果**:
- 返回成功消息
- 提示"恭喜您，数据已全部导入成功！共 X 条"
- 用户信息已更新
- 学生档案信息已更新
- 不会创建重复记录

**实际结果**: 
- [ ] 通过
- [ ] 失败

**验证SQL**:
```sql
-- 验证用户总数未增加
SELECT COUNT(*) FROM sys_user WHERE user_name LIKE '2507%' OR user_name LIKE 'T2024%';
-- 预期: 仍为10

-- 验证数据已更新
SELECT user_name, phonenumber, email FROM sys_user WHERE user_name = '2507240101';
-- 预期: 显示更新后的手机号和邮箱
```

**备注**: 

---

### 测试用例6：混合场景测试

**测试目的**: 验证部分成功、部分失败的场景

**测试数据**: `学生批量导入测试数据_混合.xlsx`

**测试步骤**:
1. 准备包含正常和错误数据的Excel文件
2. 调用导入接口
3. 检查结果

**预期结果**:
- 返回失败消息（因为有错误数据）
- 事务回滚，所有数据都不导入
- 数据库保持一致性

**实际结果**: 
- [ ] 通过
- [ ] 失败

**备注**: 

---

### 测试用例7：角色分配验证

**测试目的**: 验证不同身份的角色分配是否正确

**测试步骤**:
1. 导入包含学生、班委、辅导员的数据
2. 查询sys_user_role表
3. 验证角色分配

**预期结果**:
- 学生: role_id=100
- 班委: role_id=100,101（双角色）
- 辅导员: role_id=102

**实际结果**: 
- [ ] 通过
- [ ] 失败

**验证SQL**:
```sql
SELECT u.user_name, u.nick_name, GROUP_CONCAT(ur.role_id) AS role_ids
FROM sys_user u
JOIN sys_user_role ur ON u.user_id = ur.user_id
WHERE u.user_name IN ('2507240101', '2507240102', 'T20240001')
GROUP BY u.user_id;
```

**备注**: 

---

### 测试用例8：学生档案创建验证

**测试目的**: 验证学生档案是否正确创建

**测试步骤**:
1. 导入学生数据
2. 查询t_user_profile表
3. 验证档案信息

**预期结果**:
- 学生和班委创建档案
- 辅导员不创建档案
- 档案信息正确：
  - student_id = 学号
  - college、major、class_name从部门树解析
  - grade从学号推断
  - political_status、enrollment_date正确填充

**实际结果**: 
- [ ] 通过
- [ ] 失败

**验证SQL**:
```sql
SELECT p.student_id, p.college, p.major, p.grade, p.class_name, 
       p.political_status, p.enrollment_date
FROM t_user_profile p
WHERE p.student_id = '2507240101';
-- 预期:
-- college: 信息学院
-- major: 软件工程
-- grade: 2025
-- class_name: 2401
```

**备注**: 

---

### 测试用例9：权限控制测试

**测试目的**: 验证权限控制是否生效

**测试步骤**:
1. 使用无权限用户登录
2. 尝试调用导入接口
3. 检查响应

**预期结果**:
- 返回403 Forbidden
- 提示"没有权限"

**实际结果**: 
- [ ] 通过
- [ ] 失败

**备注**: 

---

### 测试用例10：性能测试

**测试目的**: 验证批量导入性能

**测试数据**: 
- 小批量: 50条
- 中批量: 200条
- 大批量: 500条

**测试步骤**:
1. 准备不同规模的测试数据
2. 分别执行导入
3. 记录耗时

**预期结果**:
- 50条: < 5秒
- 200条: < 20秒
- 500条: < 60秒

**实际结果**:

| 数据量 | 耗时 | 状态 |
|--------|------|------|
| 50条   |      | [ ] 通过 / [ ] 失败 |
| 200条  |      | [ ] 通过 / [ ] 失败 |
| 500条  |      | [ ] 通过 / [ ] 失败 |

**备注**: 

---

## 缺陷汇总

| 缺陷ID | 严重程度 | 缺陷描述 | 复现步骤 | 状态 |
|--------|----------|----------|----------|------|
| BUG-001 | 高/中/低 | [描述] | [步骤] | 待修复/已修复 |

## 测试总结

### 测试覆盖率
- 功能测试用例: X/10 通过
- 性能测试用例: X/3 通过
- 安全测试用例: X/1 通过
- **总体通过率**: X%

### 主要问题
1. [列出主要问题]
2. 
3. 

### 改进建议
1. [列出改进建议]
2. 
3. 

### 测试结论
- [ ] 功能符合需求，建议发布
- [ ] 存在问题，需要修复后重新测试
- [ ] 不符合需求，需要重新开发

### 测试人员签名
测试人员: ___________  日期: ___________

### 审核人员签名
审核人员: ___________  日期: ___________

