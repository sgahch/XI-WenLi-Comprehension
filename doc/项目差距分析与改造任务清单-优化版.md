# 大学生综合考评管理系统 - 项目差距分析与改造任务清单(优化版)

## 📋 文档概述

**生成时间**: 2025-11-02  
**优化版本**: v2.0  
**优化内容**: 
1. 明确RBAC权限框架使用策略(独立页面+菜单权限控制)
2. 新增成绩截图核验功能
3. 采用动态Excel导出方案(无需模板上传)
4. 调整工时和优先级

---

## 🎯 核心差距总结

### 严重程度分级
- 🔴 **P0 - 严重缺失**: 核心功能完全缺失，严重影响系统可用性 (6项)
- 🟠 **P1 - 重要缺失**: 重要功能缺失或不完整，影响用户体验 (9项)
- 🟡 **P2 - 一般缺失**: 功能存在但需优化，影响系统完整性 (5项)
- 🟢 **P3 - 轻微缺失**: 细节优化，不影响核心功能 (1项)

**总计**: 21项差距

---

## 一、用户角色与权限管理差距

### 🔴 P0-1: 班委角色功能严重缺失

**需求描述**:
- 班委需要对本班学生提交的加分材料进行真实性校验
- 班委需要自动统计班级数据并生成班级考评数据表
- 班委需要实时查看本班学生材料提交进度并发送提醒

**当前状态**:
- ✅ 已有班委角色定义（角色ID: 101）
- ✅ 已有菜单权限配置（menu_id: 2120审核页面、2131通过、2132驳回、2133详情）
- ❌ 缺少班委专属审核页面实现
- ❌ 缺少班级数据统计和汇总功能
- ❌ 缺少学生提交进度监控和提醒功能
- ❌ 缺少证书真实性校验工具

**优化方案**:
- ✅ **采用独立页面策略**: 创建 `ruoyi-ui/src/views/evaluation-submit/classCommittee/` 目录
- ✅ **利用RBAC框架**: 通过菜单权限控制访问，无需在代码中大量判断角色
- ✅ **页面职责清晰**: 班委、学生、辅导员各自独立页面，互不干扰

**影响**:
- 班委无法完成初审工作
- 审核流程中断，无法流转到辅导员
- 班级数据需要手动汇总，失去系统化管理优势

---

### 🟠 P1-1: 成绩截图核验功能缺失 🆕

**需求描述**:
- 学生提交材料时需上传教务系统成绩截图
- 班委及以上角色可查看截图并对比学生提交的成绩数据
- 系统支持截图放大查看和并排对比

**当前状态**:
- ✅ 已有附件表（`evaluation_attachment`）
- ❌ 缺少附件类型字段区分证书和成绩截图
- ❌ 缺少学生端成绩截图上传功能
- ❌ 缺少班委端截图查看和对比界面

**实现方案**:
```sql
-- 数据库修改
ALTER TABLE evaluation_attachment 
ADD COLUMN attachment_type VARCHAR(32) DEFAULT 'CERTIFICATE' 
COMMENT '附件类型：CERTIFICATE-证书，GRADE_SCREENSHOT-成绩截图';

CREATE INDEX idx_attachment_type ON evaluation_attachment(attachment_type);
```

**前端实现**:
- 学生端: 在提交表单中增加"成绩截图"上传区域
- 班委端: 审核页面增加"查看成绩截图"按钮，弹窗显示截图和提交成绩对比

**工时估算**: 2天

---

### 🟠 P1-2: 辅导员角色功能不完整

**需求描述**:
- 辅导员需要对班委提交的班级考评数据进行系统性核验
- 辅导员需要设置公示期并导出公示名单
- 辅导员需要接收学生申诉并进行复核

**当前状态**:
- ✅ 已有辅导员审核接口（`/evaluation/submission/audit`）
- ✅ 已有申诉管理基础表结构（`t_appeal`）
- ❌ 缺少数据异常检测和高亮显示功能
- ❌ 缺少公示期设置和公示名单生成功能
- ❌ 缺少申诉与原始材料、审核记录的自动关联
- ❌ 缺少申诉处理后的结果同步机制

**优化方案**:
- 创建独立的辅导员审核页面 `counselor/audit.vue`
- 创建公示管理页面 `counselor/publicity.vue`
- 创建申诉处理页面 `counselor/appeal.vue`

---

## 二、考评规则管理差距

### 🔴 P0-2: 学院规则自定义功能缺失

**需求描述**:
- 各学院可独立设置指标权重（如文学院社会实践40%，理工学院科研创新50%）
- 管理员可以增删考评维度、调整维度权重
- 权重调整后系统自动同步至所有用户的指标展示页面

**当前状态**:
- ✅ 已有基础规则表（`evaluation_rule`）支持维度化管理
- ❌ 缺少学院级别的规则配置界面
- ❌ 缺少权重动态调整功能
- ❌ 缺少权重总和自动校验（必须为100%）
- ❌ 规则变更后缺少自动同步机制

**影响**:
- 无法满足不同学院的差异化考评需求
- 规则管理缺乏灵活性

---

## 三、材料提交与审核流程差距

### 🔴 P0-3: 审核流程自动流转逻辑缺失

**需求描述**:
- 学生提交后自动进入"待班委审核"状态
- 班委审核通过后自动流转到"待辅导员审核"
- 辅导员审核通过后自动进入"已通过"状态
- 任一环节驳回后返回"待修改"状态

**当前状态**:
- ✅ 已有状态字段（0草稿、1待班委审核、2待辅导员审核、3已通过、4已驳回）
- ✅ 已有审核接口（`/evaluation/submission/audit`）
- ❌ 审核接口中缺少自动流转逻辑
- ❌ 缺少状态机管理
- ❌ 缺少审核权限校验（班委只能审核status=1的记录）

**实现方案**:
```java
// 状态流转逻辑
if (currentStatus == 1 && operation == APPROVE && role == MONITOR) {
    newStatus = 2; // 流转到待辅导员审核
} else if (currentStatus == 2 && operation == APPROVE && role == COUNSELOR) {
    newStatus = 3; // 流转到已通过
} else if (operation == REJECT) {
    newStatus = 4; // 驳回
}
```

---

### 🔴 P0-4: 考评结果公示功能缺失

**需求描述**:
- 辅导员审核通过后，系统自动生成公示名单
- 公示期内学生可查看自己的排名和分数
- 公示期结束后自动锁定数据，不可修改

**当前状态**:
- ❌ 完全缺失公示功能
- ❌ 缺少公示期配置表
- ❌ 缺少公示名单生成逻辑
- ❌ 缺少公示页面

**数据库设计**:
```sql
CREATE TABLE `t_publicity` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '公示ID',
  `academic_year` varchar(20) NOT NULL COMMENT '学年',
  `semester` tinyint NOT NULL COMMENT '学期',
  `class_id` bigint NOT NULL COMMENT '班级ID',
  `start_time` datetime NOT NULL COMMENT '公示开始时间',
  `end_time` datetime NOT NULL COMMENT '公示结束时间',
  `status` tinyint DEFAULT 0 COMMENT '状态：0-公示中，1-已结束',
  `create_by` varchar(64) DEFAULT NULL,
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) COMMENT='公示管理表';
```

---

### 🔴 P0-5: 审核状态实时通知功能缺失

**需求描述**:
- 学生提交后，班委收到待审核通知
- 班委审核后，学生收到审核结果通知
- 辅导员审核后，学生收到最终结果通知

**当前状态**:
- ❌ 完全缺失通知功能
- ❌ 缺少通知表
- ❌ 缺少通知发送逻辑
- ❌ 缺少前端通知组件

**实现方案**:
- 使用若依框架的 `sys_notice` 表
- 在审核接口中增加通知发送逻辑
- 前端使用WebSocket或轮询获取通知

---

## 四、数据统计与导出差距

### 🔴 P0-6: 动态Excel导出功能缺失 🆕

**需求描述**:
- 不同学院课程不同，需要动态生成Excel列
- 不同学生参加的活动不同，需要动态添加活动列
- 导出的Excel需要符合综测表格式(F1/F2/F3分区，颜色区分)

**当前状态**:
- ✅ 已有基础导出功能
- ❌ 导出列固定，无法适应动态需求
- ❌ 缺少动态列收集逻辑
- ❌ 缺少样式渲染(颜色、边框)

**✅ 已实现方案**:
- ✅ 创建 `IDynamicEvaluationExportService` 接口
- ✅ 创建 `DynamicEvaluationExportServiceImpl` 实现类
- ✅ 创建 `DynamicColumnData` DTO
- ✅ 创建 `DynamicExportController` 控制器
- ✅ 支持三种导出模式:
  - 完整版: 包含所有详细列
  - 汇总版: 仅包含F1/F2/F3总分和排名
  - 学院版: 多Sheet导出所有班级

**技术特点**:
- 使用 `LinkedHashSet` 收集所有动态列名
- 使用 `Map<String, BigDecimal>` 存储动态数据
- 使用Apache POI动态生成Excel
- 支持颜色区分(F1橙色、F2绿色、F3蓝色)

**API接口**:
```
GET /evaluation/export/full?academicYear=2025-2026&semester=1&classId=200
GET /evaluation/export/summary?academicYear=2025-2026&semester=1&classId=200
GET /evaluation/export/college?academicYear=2025-2026&semester=1&collegeId=103
```

**工时估算**: 已完成(3天)

---

## 五、改造任务清单

### 阶段一: 核心审核流程修复 (15天) 🔴

#### 任务1.1: 实现班委审核功能 (5天)
- [ ] 创建班委审核页面 `classCommittee/audit.vue`
- [ ] 实现审核列表查询(仅显示本班待审核记录)
- [ ] 实现审核详情查看(包含附件预览)
- [ ] 实现审核通过/驳回操作
- [ ] 集成成绩截图查看功能
- [ ] 添加批量审核功能

**前端路由**:
```javascript
{
  path: '/evaluation-submit/classCommittee',
  component: Layout,
  meta: { title: '班委审核', icon: 'audit' },
  children: [
    {
      path: 'audit',
      component: () => import('@/views/evaluation-submit/classCommittee/audit'),
      name: 'ClassCommitteeAudit',
      meta: { title: '材料审核', perms: ['evaluation:audit:class'] }
    }
  ]
}
```

#### 任务1.2: 实现成绩截图核验功能 (2天) 🆕
- [ ] 数据库: 添加 `attachment_type` 字段
- [ ] 后端: 修改附件上传接口支持类型参数
- [ ] 前端: 学生端增加成绩截图上传
- [ ] 前端: 班委端增加截图查看对比界面

#### 任务1.3: 完善审核流程自动流转 (3天)
- [ ] 后端: 实现状态机管理类
- [ ] 后端: 修改审核接口增加自动流转逻辑
- [ ] 后端: 增加审核权限校验
- [ ] 测试: 完整流程测试(学生提交→班委审核→辅导员审核)

#### 任务1.4: 实现公示功能 (3天)
- [ ] 数据库: 创建 `t_publicity` 表
- [ ] 后端: 实现公示管理Service
- [ ] 后端: 实现公示名单生成接口
- [ ] 前端: 辅导员端公示管理页面
- [ ] 前端: 学生端公示查看页面

#### 任务1.5: 实现通知功能 (2天)
- [ ] 后端: 集成 `sys_notice` 表
- [ ] 后端: 在审核接口中增加通知发送
- [ ] 前端: 增加通知中心组件
- [ ] 前端: 增加消息提示

---

### 阶段二: 规则管理与配置 (9天) 🟠

#### 任务2.1: 实现学院规则自定义 (4天)
- [ ] 后端: 实现学院规则配置Service
- [ ] 后端: 增加权重校验逻辑(总和=100%)
- [ ] 前端: 学院规则配置页面
- [ ] 前端: 权重调整可视化组件

#### 任务2.2: 实现规则变更同步 (2天)
- [ ] 后端: 实现规则变更通知机制
- [ ] 前端: 规则变更提示
- [ ] 前端: 学生端指标体系查看页面

#### 任务2.3: 实现考评指标可视化 (3天)
- [ ] 前端: 使用ECharts展示指标体系
- [ ] 前端: 实现指标树形结构展示
- [ ] 前端: 实现权重饼图展示

---

### 阶段三: 数据统计与可视化 (7天) 🟡

#### 任务3.1: 实现班级数据统计 (3天)
- [ ] 后端: 实现班级统计Service
- [ ] 后端: 实现排名计算逻辑
- [ ] 前端: 班委端统计页面
- [ ] 前端: 数据图表展示

#### 任务3.2: 完善动态Excel导出 (2天) ✅
- [x] 后端: 已完成动态导出Service
- [x] 后端: 已完成导出Controller
- [ ] 前端: 增加导出按钮和参数选择
- [ ] 测试: 测试各种场景的导出

#### 任务3.3: 实现数据可视化大屏 (2天)
- [ ] 前端: 实现学院数据大屏
- [ ] 前端: 实现班级数据大屏
- [ ] 前端: 实现个人数据分析页面

---

### 阶段四: 系统配置与优化 (5天) 🟢

#### 任务4.1: 完善数据权限控制 (2天)
- [ ] 后端: 验证 `@DataScope` 注解配置
- [ ] 后端: 增加学院数据隔离测试
- [ ] 测试: 多角色数据权限测试

#### 任务4.2: 实现系统配置管理 (2天)
- [ ] 后端: 实现系统参数配置
- [ ] 前端: 系统配置页面
- [ ] 前端: 学期切换功能

#### 任务4.3: 性能优化 (1天)
- [ ] 后端: 增加缓存
- [ ] 后端: SQL优化
- [ ] 前端: 列表分页优化

---

### 阶段五: 测试与验收 (4天)

#### 任务5.1: 功能测试 (2天)
- [ ] 学生端完整流程测试
- [ ] 班委端完整流程测试
- [ ] 辅导员端完整流程测试
- [ ] 管理员端完整流程测试

#### 任务5.2: 性能测试 (1天)
- [ ] 并发测试
- [ ] 大数据量测试
- [ ] 导出性能测试

#### 任务5.3: 用户验收 (1天)
- [ ] 用户培训
- [ ] 用户试用
- [ ] 问题收集和修复

---

## 六、工时汇总

| 阶段 | 工时(天) | 优先级 | 状态 |
|------|---------|--------|------|
| 阶段一: 核心审核流程修复 | 15 | P0 | 待开始 |
| 阶段二: 规则管理与配置 | 9 | P1 | 待开始 |
| 阶段三: 数据统计与可视化 | 7 | P1 | 部分完成 |
| 阶段四: 系统配置与优化 | 5 | P2 | 待开始 |
| 阶段五: 测试与验收 | 4 | P0 | 待开始 |
| **总计** | **40天** | - | - |

**调整说明**:
- 原计划: 8周(40天)
- 新增: 成绩截图功能(+2天)
- 优化: 动态Excel导出已完成(-0.5天)
- 调整后: 8.5周(42.5天) ≈ **9周**

---

## 七、优化建议总结

### ✅ 已采纳的优化方案

1. **RBAC权限框架策略**: 采用独立页面+菜单权限控制，而非共用页面+v-if判断
2. **成绩截图核验**: 在附件表增加类型字段，支持截图上传和查看对比
3. **动态Excel导出**: 采用动态列生成方案，无需管理员上传模板

### 🎯 核心优势

| 优化点 | 优势 |
|--------|------|
| 独立页面策略 | 代码清晰、易维护、性能好 |
| 成绩截图核验 | 提高审核准确性、减少作弊 |
| 动态Excel导出 | 零配置、自动适应、易扩展 |

---

## 八、风险提示

### ⚠️ 高风险项

1. **审核流程改造**: 涉及核心业务逻辑，需要充分测试
2. **数据权限控制**: 需要严格测试，防止数据泄露
3. **动态Excel导出**: 需要测试各种边界情况

### 💡 建议

1. **分阶段上线**: 先上线核心功能，再逐步完善
2. **灰度发布**: 先在小范围班级试用，再全面推广
3. **数据备份**: 改造前做好数据备份

---

## 九、后续扩展

### 可扩展功能

- [ ] 移动端支持(微信小程序)
- [ ] AI智能审核(证书真伪识别)
- [ ] 区块链存证(防篡改)
- [ ] 数据分析报告自动生成
- [ ] 与教务系统对接(自动获取成绩)

---

**文档结束**

